var cols=5,rows=6,colWidth=101,rowHeight=83,heightAdjustment=-25,minX=-1*colWidth,maxX=cols*colWidth,maxY=rows*rowHeight,globalSpeedMultiplyer=15,individualSpeedBooster=1,canvasWidth=505,canvasHeight=606;function Entity(){this.init()}Entity.prototype.init=function(){this.col=this.row=0;this.show=!1};Entity.prototype.update=function(a){this.x=this.col*colWidth;this.y=this.row*rowHeight+heightAdjustment};Entity.prototpye.getSpritePath=function(){return""};
Entity.prototype.render=function(){this.show&&ctx.drawImage(Resources.get(this.getSpritePath()),this.x,this.y)};Gem.prototype=Object.create(Entity.prototype);Gem.prototype.init=function(){Object.getPrototypeOf(Gem.prototype).init(this);this.row=Math.floor(3*Math.random()+1);this.col=Math.floor(5*Math.random());setTimeout(function(){this.show=!0;setTimeout(this.init(),1E3*Math.floor(3*Math.random()+3))},1E3*Math.floor(10*Math.random()+10))};Entity.prototpye.getSpritePath=function(){return"images/gem-blue.png"};
function Enemy(a,b){this.sprite="images/enemy-bug.png";this.respawn(a,b)}Enemy.prototype.update=function(a){this.x>maxX||this.x<minX?this.respawn():this.x+=this.speed*a*globalSpeedMultiplyer};Enemy.prototype.render=function(){0>this.speed?(ctx.scale(-1,1),ctx.drawImage(Resources.get(this.sprite),-this.x-1*colWidth,this.y),ctx.scale(-1,1)):ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};
Enemy.prototype.respawn=function(a,b){this.direction=2*Math.floor(2*Math.random()+1)-3;this.row="undefined"!==typeof a?a:Math.floor(3*Math.random()+1);this.speed="undefined"!==typeof b?b:Math.floor(Math.random()*(5+individualSpeedBooster)+2)*this.direction;this.col=-1;-1==this.direction&&(this.col=cols);this.x=this.col*colWidth;this.y=this.row*rowHeight+heightAdjustment;return this};
Enemy.prototype.touchesPlayer=function(a){return this.row!=a.row?!1:this.x>a.x-.75*colWidth&&this.x<a.x+.75*colWidth?!0:!1};Enemy.prototype.freeze=function(){1<Math.abs(this.speed)&&(this.speed*=.1)};var Player=function(){this.sprite="images/char-boy.png"};Player.prototype.reset=function(){this.respawn();this.score=0;this.lives=3;this.isGameOver=!1};Player.prototype.respawn=function(){this.row=5;this.col=2;this.x=this.col*colWidth;this.y=this.row*rowHeight+heightAdjustment};
Player.prototype.render=function(){var a=Resources.get(this.sprite);ctx.drawImage(a,this.x,this.y);ctx.fillStyle="black";ctx.font="30px Open Sans";ctx.textAlign="left";ctx.fillText("Score: "+player.score,10,36);ctx.drawImage(a,canvasWidth-.4*a.width,-15,.4*a.width,.4*a.height);ctx.textAlign="right";ctx.fillText(""+player.lives,canvasWidth-.4*a.width-10,36);this.isGameOver&&(ctx.fillStyle="#2c2c2c",ctx.lineWidth=2,ctx.strokeStyle="white",ctx.font="60px Open Sans",ctx.textAlign="center",ctx.strokeText("GAME OVER",
canvasWidth/2,canvasHeight/2),ctx.fillText("GAME OVER",canvasWidth/2,canvasHeight/2))};Player.prototype.hit=function(){--this.lives;this.score-=100;0==this.lives?this.isGameOver=!0:this.respawn()};Player.prototype.scored=function(a){this.score+=a;this.respawn()};
Player.prototype.handleInput=function(a){if(!this.isGameOver)switch(a){case "up":--this.row;break;case "down":this.row+=1;break;case "left":--this.col;break;case "right":this.col+=1}0>this.row?this.row=0:this.row>=rows&&(this.row=rows-1);0>this.col?this.col=0:this.col>=cols&&(this.col=cols-1);this.x=101*this.col;this.y=83*this.row-25};var allEnemies=[],player=new Player,gem=new Gem;document.addEventListener("keydown",function(a){player.handleInput({37:"left",38:"up",39:"right",40:"down"}[a.keyCode])});